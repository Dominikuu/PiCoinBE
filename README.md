# UrlShortener-api - Dockerized

This is a backend service for combined with authenication and url shortener.
You can integrate with https://github.com/Dominikuu/url-shortener

1. Clone this repo
2. run `npm install`
3. Make sure you have docker installed and running on your computer
4. Run `docker-compose up` ( you may have to run `docker-compose up --build` for the first setup phase)
5. You will also need to update listening port in server.js to your client app port

**Important:** if you are getting conflict erros, you should run `docker stop <container name>` that is already running in the background.
**Important:** if you are getting other erros, you should run `docker-compose down` to bring everything down, and start over.

To access backend's bash:
Run `docker-compose exec smart-brain-api bash`

To access postgres: (adjust PORT number if needed)
Run  `psql postgres://<username>:<password>@localhost:5432/smart-brain`

To access redis:
Run `docker-compose exec redis redis-cli`

# Deploy to Elastic Beanstalk on AWS

1. Create a new elastic beanstalk env, and get AWS key and password
2. Create related docker image repository on docker hub
3. Make github bundle to travis-ci
4. set environment variables (e.g. Docker id, AWS key...)
5. Transform docker-compose.yml to Dockerrun.aws.josn (container-transform is recommended and only for python3)
6. Install `pip install eb-cli`
7. Run `eb init --<environment name>`
7. Run `eb local run` for testing your Dockerrun.aws.json
8. Commit the changes and push to github

**Important:** Dockerrun.aws.json generated by container-transform will lost some import parameter, so it is needed to check use `eb lcoal run`
**Important:** EC2 instance type should not choose t2.micro. It gonna happended that there is no enough memory for redis in ec2 instance

To get log on EBS::
Run `eb logs` or check on aws.com
